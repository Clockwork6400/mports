PORTNAME=	uriparser
DISTVERSION=	0.9.6
CATEGORIES=	net
MASTER_SITES=	https://github.com/${PORTNAME}/${PORTNAME}/releases/download/${PORTNAME}-${PORTVERSION}/
DISTFILES=	${DISTNAME}${EXTRACT_SUFX}
EXTRACT_ONLY=	${DISTNAME}${EXTRACT_SUFX}

MAINTAINER=	ports@MidnightBSD.org
COMMENT=	URI parsing library

LICENSE=	bsd3
LICENSE_FILE=	${WRKSRC}/COPYING

BUILD_DEPENDS=	bash:shells/bash

USES=		cmake:noninja cpe pathfix tar:xz
CPE_VENDOR=	uriparser_project
USE_LDCONFIG=	yes

CMAKE_OFF=	URIPARSER_BUILD_TESTS URIPARSER_BUILD_DOCS # will fetch prebuilds from the upstream, if DOCS is selected

NO_TEST=	yes

PLIST_SUB=	DISTVERSION=${DISTVERSION}
PORTDOCS=	*

OPTIONS_DEFINE=		DOCS
DOCS_DISTFILES=		${_DISTDOCSFILE} \
			${DISTNAME}.qch
DOCS_EXTRACT_ONLY=	${_DISTDOCSFILE}

_DISTDOCSFILE=	${_DISTDOCSNAME}.zip
_DISTDOCSNAME=	${DISTNAME}-doc

post-install-DOCS-on:
	${MKDIR} ${FAKE_DESTDIR}${DOCSDIR}/qch
	cd ${WRKSRC}/doc && ${COPYTREE_SHARE} . ${FAKE_DESTDIR}${DOCSDIR}
	cd ${WRKSRC}/../${_DISTDOCSNAME} && ${COPYTREE_SHARE} . ${FAKE_DESTDIR}${DOCSDIR}
	${INSTALL_MAN} ${DISTDIR}/${DISTNAME}.qch ${FAKE_DESTDIR}${DOCSDIR}/qch
	( ${ECHO} "QCH file is a QT Compressed Help file, generated by doxygen, cf:"; \
	${ECHO} "https://doc.qt.io/qt-5/assistant-details.html"; ) > ${FAKE_DESTDIR}${DOCSDIR}/qch/readme-qch

.include <bsd.port.mk>
